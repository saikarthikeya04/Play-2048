<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>2048 - Join the numbers!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
            overscroll-behavior: none;
        }

        body {
            font-family: 'Arial', 'Helvetica Neue', sans-serif;
            background: #000000;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        .ad-space {
            background: #1a1a1a;
            border: 2px dashed #333333;
            border-radius: 8px;
            padding: 20px;
            margin: 10px auto;
            text-align: center;
            color: #666666;
            font-size: 14px;
        }

        .top-ad {
            height: 90px;
            max-width: 728px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .side-ad {
            width: 160px;
            height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
        }

        .game-wrapper {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: flex-start;
            margin: 20px 0;
        }

        h1 {
            font-size: 80px;
            font-weight: bold;
            color: #ffffff;
            margin: 20px 0 10px;
            text-align: center;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .subtitle {
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
            color: #aaaaaa;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px auto;
            max-width: 600px;
            gap: 20px;
        }

        .score-box {
            background: #222222;
            color: white;
            padding: 10px 25px;
            border-radius: 12px;
            text-align: center;
            min-width: 100px;
            border: 3px solid #444444;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .score-label {
            font-size: 13px;
            text-transform: uppercase;
            font-weight: bold;
            color: #888888;
            margin-bottom: 3px;
        }

        .score-value {
            font-size: 28px;
            font-weight: bold;
            color: #ffffff;
        }

        /* BUTTON STYLING - Applies to ALL new-game-btn elements */
        .new-game-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 3px solid #764ba2;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .new-game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        /* THE MAIN GAME BOX */
        .game-board {
            width: 600px;
            height: 600px;
            background: #1a1a1a;
            border-radius: 15px;
            padding: 20px;
            position: relative;
            margin: 0 auto;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
            border: 4px solid #333333;
            touch-action: none;
        }

        /* THE GRID CELLS (4x4 background squares) */
        .grid-background {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 20px;
            width: 100%;
            height: 100%;
        }

        .grid-cell {
            background: #0d0d0d;
            border-radius: 10px;
            border: 3px solid #2a2a2a;
        }

        /* TILES CONTAINER (sits on top of grid) */
        .tiles {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            z-index: 10;
        }

        .tile {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 55px;
            font-weight: bold;
            border-radius: 10px;
            transition: all 0.15s ease-in-out;
            border: 4px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
        }

        .tile-new {
            animation: appear 0.2s ease-in-out;
        }

        .tile-merged {
            animation: pop 0.2s ease-in-out;
        }

        @keyframes appear {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        .tile-2 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #ffffff; }
        .tile-4 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: #ffffff; }
        .tile-8 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: #ffffff; }
        .tile-16 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: #ffffff; }
        .tile-32 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: #ffffff; }
        .tile-64 { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); color: #ffffff; }
        .tile-128 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #000000; font-size: 48px; }
        .tile-256 { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: #000000; font-size: 48px; }
        .tile-512 { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #000000; font-size: 48px; }
        .tile-1024 { background: linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%); color: #ffffff; font-size: 42px; }
        .tile-2048 { background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); color: #ffffff; font-size: 42px; }
        .tile-super { background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%); color: #ffffff; font-size: 36px; }

        .game-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 100;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .game-message.show {
            display: flex;
        }

        .game-message h2 {
            font-size: 70px;
            color: #ffffff;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(102, 126, 234, 0.8);
        }

        .game-message p {
            font-size: 24px;
            margin-bottom: 30px;
            color: #aaaaaa;
        }

        @media screen and (max-width: 900px) {
            .side-ad {
                display: none;
            }
        }

        @media screen and (max-width: 650px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 50px;
            }

            .subtitle {
                font-size: 16px;
            }

            .game-board {
                width: 100%;
                max-width: 450px;
                height: auto;
                aspect-ratio: 1;
                padding: 15px;
            }

            .grid-background {
                gap: 15px;
            }

            .tiles {
                top: 15px;
                left: 15px;
                right: 15px;
                bottom: 15px;
            }

            .tile {
                font-size: 40px;
                border-width: 3px;
            }

            .tile-128, .tile-256, .tile-512 {
                font-size: 35px;
            }

            .tile-1024, .tile-2048 {
                font-size: 28px;
            }

            .tile-super {
                font-size: 24px;
            }

            .header {
                flex-direction: row;
                gap: 15px;
                justify-content: center;
            }
            
            .new-game-btn, .score-box {
                flex: 1;
                max-width: 200px;
            }
            
            .game-message h2 {
                font-size: 50px;
            }
            
            .game-message p {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>2048</h1>
        <div class="subtitle">Join the numbers and get to the 2048 tile!</div>

        <div class="header">
            <button class="new-game-btn" onclick="game.init()">New Game</button>
            <div class="score-box">
                <div class="score-label">Score</div>
                <div class="score-value" id="score">0</div>
            </div>
        </div>

        <div class="game-wrapper">
            <div class="ad-space side-ad">
                Ad Space (160x600)
            </div>

            <div class="game-board">
                <div class="grid-background">
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                    <div class="grid-cell"></div>
                </div>
                <div class="tiles" id="tiles"></div>
            </div>

            <div class="ad-space side-ad">
                Ad Space (160x600)
            </div>
        </div>

        <div class="ad-space top-ad" style="margin-top: 20px;">
            Advertisement Space (728x90)
        </div>
    </div>

    <div class="game-message" id="game-message">
        <h2 id="message-text"></h2>
        <p id="message-score"></p>
        <button class="new-game-btn" onclick="game.init()">Try Again</button>
    </div>

    <script>
        const game = {
            board: [],
            score: 0,
            tileId: 0,

            init() {
                this.board = [
                    [null, null, null, null],
                    [null, null, null, null],
                    [null, null, null, null],
                    [null, null, null, null]
                ];
                this.score = 0;
                this.tileId = 0;
                this.updateScore();
                document.getElementById('game-message').classList.remove('show');
                document.getElementById('tiles').innerHTML = '';
                this.addRandomTile();
                this.addRandomTile();
            },

            addRandomTile() {
                const empty = [];
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (!this.board[row][col]) {
                            empty.push({ row, col });
                        }
                    }
                }
                if (empty.length > 0) {
                    const pos = empty[Math.floor(Math.random() * empty.length)];
                    const value = Math.random() < 0.9 ? 2 : 4;
                    this.board[pos.row][pos.col] = {
                        value: value,
                        id: this.tileId++,
                        isNew: true,
                        merged: false
                    };
                    this.createTile(pos.row, pos.col);
                }
            },

            createTile(row, col) {
                const tile = this.board[row][col];
                const tileEl = document.createElement('div');
                tileEl.className = `tile tile-${tile.value > 2048 ? 'super' : tile.value}`;
                tileEl.dataset.id = tile.id;
                tileEl.textContent = tile.value;
                
                if (tile.isNew) {
                    tileEl.classList.add('tile-new');
                }

                const pos = this.getTilePosition(row, col);
                tileEl.style.width = pos.size + 'px';
                tileEl.style.height = pos.size + 'px';
                tileEl.style.left = pos.left + 'px';
                tileEl.style.top = pos.top + 'px';

                document.getElementById('tiles').appendChild(tileEl);
            },

            getTilePosition(row, col) {
                const board = document.querySelector('.game-board');
                const padding = 20;
                const gap = 20;
                const boardSize = board.offsetWidth - (padding * 2);
                const tileSize = (boardSize - (gap * 3)) / 4;

                return {
                    size: tileSize,
                    left: col * (tileSize + gap),
                    top: row * (tileSize + gap)
                };
            },

            updateTilePosition(tileEl, row, col) {
                const pos = this.getTilePosition(row, col);
                tileEl.style.left = pos.left + 'px';
                tileEl.style.top = pos.top + 'px';
            },

            move(direction) {
                const vector = {
                    up: { row: -1, col: 0 },
                    down: { row: 1, col: 0 },
                    left: { row: 0, col: -1 },
                    right: { row: 0, col: 1 }
                }[direction];

                let moved = false;
                const traversals = this.buildTraversals(vector);

                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (this.board[row][col]) {
                            this.board[row][col].merged = false;
                        }
                    }
                }

                traversals.row.forEach(row => {
                    traversals.col.forEach(col => {
                        const tile = this.board[row][col];
                        if (!tile) return;

                        const farthest = this.findFarthestPosition({ row, col }, vector);
                        const nextTile = this.board[farthest.next.row]?.[farthest.next.col];

                        if (nextTile && nextTile.value === tile.value && !nextTile.merged) {
                            nextTile.value *= 2;
                            nextTile.merged = true;
                            this.score += nextTile.value;
                            this.board[row][col] = null;

                            const tileEl = document.querySelector(`[data-id="${tile.id}"]`);
                            const nextTileEl = document.querySelector(`[data-id="${nextTile.id}"]`);
                            
                            if (tileEl) {
                                this.updateTilePosition(tileEl, farthest.next.row, farthest.next.col);
                                setTimeout(() => tileEl.remove(), 150);
                            }

                            if (nextTileEl) {
                                nextTileEl.textContent = nextTile.value;
                                nextTileEl.className = `tile tile-${nextTile.value > 2048 ? 'super' : nextTile.value} tile-merged`;
                            }

                            moved = true;
                        } else {
                            if (farthest.farthest.row !== row || farthest.farthest.col !== col) {
                                this.board[farthest.farthest.row][farthest.farthest.col] = tile;
                                this.board[row][col] = null;

                                const tileEl = document.querySelector(`[data-id="${tile.id}"]`);
                                if (tileEl) {
                                    this.updateTilePosition(tileEl, farthest.farthest.row, farthest.farthest.col);
                                }

                                moved = true;
                            }
                        }
                    });
                });

                if (moved) {
                    setTimeout(() => {
                        this.addRandomTile();
                        this.updateScore();

                        if (this.hasWon()) {
                            this.showMessage('You Win!', 'Congratulations!');
                        } else if (this.isGameOver()) {
                            this.showMessage('Game Over!', 'No more moves available');
                        }
                    }, 150);
                }
            },

            buildTraversals(vector) {
                const traversals = { row: [], col: [] };

                for (let i = 0; i < 4; i++) {
                    traversals.row.push(i);
                    traversals.col.push(i);
                }

                if (vector.row === 1) traversals.row.reverse();
                if (vector.col === 1) traversals.col.reverse();

                return traversals;
            },

            findFarthestPosition(cell, vector) {
                let previous;
                do {
                    previous = cell;
                    cell = {
                        row: previous.row + vector.row,
                        col: previous.col + vector.col
                    };
                } while (
                    cell.row >= 0 && cell.row < 4 &&
                    cell.col >= 0 && cell.col < 4 &&
                    !this.board[cell.row][cell.col]
                );

                return {
                    farthest: previous,
                    next: cell
                };
            },

            updateScore() {
                document.getElementById('score').textContent = this.score;
            },

            hasWon() {
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        const tile = this.board[row][col];
                        if (tile && tile.value === 2048) return true;
                    }
                }
                return false;
            },

            isGameOver() {
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (!this.board[row][col]) return false;
                    }
                }

                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        const tile = this.board[row][col];
                        if (col < 3 && this.board[row][col + 1]?.value === tile.value) return false;
                        if (row < 3 && this.board[row + 1][col]?.value === tile.value) return false;
                    }
                }

                return true;
            },

            showMessage(title, subtitle) {
                document.getElementById('message-text').textContent = title;
                document.getElementById('message-score').textContent = subtitle;
                document.getElementById('game-message').classList.add('show');
            }
        };

        document.addEventListener('keydown', (e) => {
            const keyMap = {
                'ArrowUp': 'up',
                'ArrowDown': 'down',
                'ArrowLeft': 'left',
                'ArrowRight': 'right'
            };

            if (keyMap[e.key]) {
                e.preventDefault();
                game.move(keyMap[e.key]);
            }
        });

        let touchStartX = 0;
        let touchStartY = 0;
        let isSwiping = false;

        const gameBoard = document.querySelector('.game-board');

        gameBoard.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            isSwiping = true;
        }, { passive: true });

        gameBoard.addEventListener('touchmove', (e) => {
            if (isSwiping) {
                e.preventDefault();
            }
        }, { passive: false });

        gameBoard.addEventListener('touchend', (e) => {
            if (!isSwiping) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const dx = touchEndX - touchStartX;
            const dy = touchEndY - touchStartY;

            if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 50) {
                game.move(dx > 0 ? 'right' : 'left');
            } else if (Math.abs(dy) > 50) {
                game.move(dy > 0 ? 'down' : 'up');
            }
            
            isSwiping = false;
        }, { passive: true });

        window.addEventListener('resize', () => {
            document.querySelectorAll('.tile').forEach(tile => {
                const id = parseInt(tile.dataset.id);
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (game.board[row][col]?.id === id) {
                            const pos = game.getTilePosition(row, col);
                            tile.style.width = pos.size + 'px';
                            tile.style.height = pos.size + 'px';
                            tile.style.left = pos.left + 'px';
                            tile.style.top = pos.top + 'px';
                        }
                    }
                }
            });
        });

        game.init();
    </script>
</body>
</html>